# Kyivstar Chatbot API

## How to start?
Before starting, edit env. with your API keys:
HUGGINGFACE_API_KEY=your_hf_token
COHERE_API_KEY=your_cohere_key

To build docker image:
docker build -t kyivstar-chatbot .

Run chatbot:
run -d -p 8030:8030 --name chatbot --env-file .env kyivstar-chatbot # First start takes 3-4 minutes

## Chat Endpoint
{
  "input": {
    "question": "What is roaming?",
    "language": "English", 
    "session_id": "123"
  }
}

## Example request
curl -X POST http://localhost:8030/chat \
  -H "Content-Type: application/json" \
  -d '{"input":{"question":"Що таке роумінг?","language":"Ukrainian","session_id":"123"}}'

## Run examples using FastAPI docs
http://127.0.0.1:8030/docs

## Methodology
### Cunking
I've tested several methodologies:
- character chunking
  This approach works effectively when combined with overlapping segments. It produces uniform chunks and maintains structural integrity, making it suitable for general document processing.
- Semantic chunking
  ![image](https://github.com/user-attachments/assets/0a087712-f744-428b-818c-bfb2ba766e85)
  Semantic splitting performs well in preserving contextual meaning but tends to generate uneven chunk sizes. To optimize results, the breakpoint percentile threshold can be adjusted to balance granularity and coherence.
  The best-performing method combines semantic splitting with secondary character-based chunking. It retains contextual relationships (via semantic analysis), ensures consistent chunk lengths (via character splitting), improves retrieval accuracy by preventing information fragmentation.

- KNN chunking
  This method struggles with consistency because the document contains repetitive terminology across different sections. As a result, KNN clustering often merges semantically related but logically distinct content into a single chunk, reducing precision.
- agent chunking
  While capable of sophisticated segmentation, this method is prohibitively slow for production use. The processing overhead makes it impractical for real-time applications.

  ### Database configuration and vectorizing
I've used ChromaDB for storing chunks, their embeddings, and metadata (semantic documents linked to each chunk). For vectorizing, I used the intfloat/multilingual-e5-small model, as it supports the Ukrainian language and performs slightly better than all-MiniLM-L6-v2. Which embedding model works best is a topic for future research.
  
  ### LLM for RAG
  As an LLM, I've used google/gemma-3-4b-it. It supports Ukrainian generative tasks, is open-source, and performs better than the 2B parameter model, but requires significant computational resources.

  ### RAG pipeline
  This part consists of several steps. Using a system prompt, I set up the model's input by providing the user’s question, relevant context, chat history, and specifying the input language. Then, I created a retriever from the vector_store, compressed and reranked it using rerank-v3.5, and passed it into the QA system. Using the compressor increased generation speed by approximately 30% and improved output precision. However, chat history significantly increases response time. To balance this, I limited the context to four chunks, which also affected answer accuracy. Improving RAG with chat memory is a subject for future research.
  

# Testing & Evaluation

Questions and answers were generated using OpenAI ChatGPT-3.5o. It provides good responses to open-ended questions but loses some details that require larger chunks (e.g., listing countries with roaming access in tariff zones). Additionally, Gemma-3-4b struggles with complex logical questions, such as “In which tariff zones is the cost per MB cheapest?” without chat history. Advanced text preprocessing and improved chunking algorithms could help address these issues.

## Quality Assessment Metrics
- **Correct answers Accuracy**: 60%  
- **Average Cosine Similarity**: 40.89%


## Questions
Що таке роумінг?
   Model Answer: Роумінг - це послуга, яка надає можливість користуватися послугами мережі, знаходячись за кордоном. Для цього достатньо мати номер Київстар. Для абонентів передплати послуги роумінгу надаються автоматично.
   Ground Truth: Роумінг — це послуга, яка дозволяє користуватися послугами мережі за кордоном. Для цього достатньо мати номер Київстар, і ваш телефон автоматично зареєструється в мережі іноземного оператора.
   Cosine Similarity: 0.55
   
--------------------------------------------------
 Як активувати роумінг для абонентів передплати?
   Model Answer: Для абонентів передплати послуги роумінгу надаються автоматично. Ваш телефон зареєструється в мережі оператора і ви зможете користуватися звичними для вас послугами в іншій країні.
   Ground Truth: Для абонентів передплати послуги роумінгу надаються автоматично. Нічого додатково налаштовувати не потрібно.
   Cosine Similarity: 0.33
   
--------------------------------------------------
 Як перевірити статус послуг роумінгу?
   Model Answer: Ви можете перевірити статус послуг роумінгу, скориставшись додатком "Мій Київстар".
   Ground Truth: Статус послуг роумінгу можна перевірити за допомогою додатку «Мій Київстар».
   Cosine Similarity: 0.43
   
--------------------------------------------------
 Що робити, якщо телефон не підключається до мережі за кордоном?
   Model Answer: Якщо не з'явилася мережа іноземного оператора на дисплеї мобільного, перезавантажте телефон. Якщо це не допомогло, встановіть автоматичний режим пошуку мережі.
   Ground Truth: Якщо телефон не підключається до мережі за кордоном, спробуйте перезавантажити телефон або встановіть автоматичний режим пошуку мережі в налаштуваннях смартфона.
   Cosine Similarity: 0.37
   
--------------------------------------------------
 Як налаштувати точку доступу (APN) для інтернету в роумінгу?
   Model Answer: Щоб користуватися інтернетом в роумінгу, у налаштуваннях телефону увімкніть передачу даних у роумінгу та виберіть точку доступу (APN) — internet.
   Ground Truth: У налаштуваннях телефона увімкніть передачу даних у роумінгу та виберіть точку доступу (APN) — internet.
   Cosine Similarity: 0.71
   
--------------------------------------------------
 Які тарифи на роумінг у країнах Євросоюзу?
   Model Answer: У країнах Євросоюзу абоненти передплати отримують послуги роумінгу на умовах, які залежать від тарифної зони.
   Ground Truth: У більшості країн Євросоюзу абоненти передплати отримують послуги роумінгу на умовах, які залежать від тарифної зони.
   Cosine Similarity: 0.82
   
--------------------------------------------------
 Яка вартість роумінгу в країнах першої тарифної зони?
   Model Answer: У першій тарифній зоні пакет 10 хвилин коштує 25,00 грн.
   Ground Truth: У країнах першої тарифної зони (наприклад, Польща, Єгипет) пакет 10 хвилин коштує 25,00 грн.
   Cosine Similarity: 0.43
   
--------------------------------------------------
 Які країни входять до другої тарифної зони?
   Model Answer: Згідно з документом, до другої тарифної зони входять такі країни: Австралія, Алжир, Ангілья, Андорра, Антигуа і Барбуда, Аргентина, Аруба, Афганістан, Бангладеш, Барбадос, Бахрейн, Бермудські острови, Бразилія, В'єтнам.
   Ground Truth: До другої тарифної зони входять такі країни, як Австралія, Алжир, Аргентина, Бразилія, В'єтнам, Індія, Індонезія та інші.
   Cosine Similarity: 0.42
   
--------------------------------------------------
 Як тарифікуються дзвінки та SMS у роумінгу?
   Model Answer: У роумінгу дзвінки та SMS тарифікуються залежно від тарифної зони, в якій знаходиться користувач. Також є країни, де тарифікація незалежна від напрямку (150 грн/хв та 15 грн/SMS). При користуванні базовими умовами плата за послуги роумінгу знімається в першу секунду першого за день роумінгового дзвінка або відправлення першого SMS.  Вихідні дзвінки та SMS із роумінгу не в Україну тарифікуються залежно від країни, куди саме ви телефонуєте або надсилаєте повідомлення.
   Ground Truth: Дзвінки та SMS із роумінгу не в Україну тарифікуються залежно від країни. У деяких країн (наприклад, Британські Віргінські острови, Куба) дзвінки коштують 150 грн/хв, а SMS — 15 грн.
   Cosine Similarity: 0.48
   
--------------------------------------------------
 Чи є безлімітний інтернет у роумінгу?
   Model Answer: Так, безлімітний доступ до інтернету є для ряду додатків та сервісів у роумінгу. Також, у додатках Google Maps та Apple Maps безлімітний трафік діє лише на карти, але за користування навігатором мегабайти зніматимуться.
   Ground Truth: Так, у роумінгу є безлімітний доступ до інтернету для певних додатків та сервісів, таких як Telegram, Facebook Messenger, Viber, WhatsApp, Google Maps, Apple Maps, Booking, AirBnB, Skyscanner, Tickets.ua, Helsi та додаток «Мій Київстар».
   Cosine Similarity: 0.39
   
--------------------------------------------------
 Які додатки мають безлімітний трафік у роумінгу?
   Model Answer: У роумінгу безлімітний трафік надається до ряду додатків та сервісів, зокрема: Booking та AirBnB, Skyscanner і Tickets.ua, Google Maps та Apple Maps. Також, за умови наявності денного пакету мегабайтів або роумінгу (Ідеальний, Простий, Комфортний) або Суперсила роумінг, безлімітний трафік надається до додатків Google Maps та Apple Maps.
   Ground Truth: Безлімітний трафік у роумінгу надається для таких додатків: Telegram, Facebook Messenger, Viber, WhatsApp (аудіодзвінки та текстові повідомлення), Google Maps, Apple Maps (лише карти), Booking, AirBnB, Skyscanner, Tickets.ua, Helsi та додаток «Мій Київстар».
   Cosine Similarity: 0.46
   
--------------------------------------------------
 Чи тарифікуються відеодзвінки у месенджерах у роумінгу?
   Model Answer: Дзвінки з відео, голосові та відеоповідомлення, а також GIFs, стікери, фото та інші медіафайли в месенджерах тарифікуються за стандартними умовами.
   Ground Truth: Так, відеодзвінки, голосові та відеоповідомлення, а також GIFs, стікери, фото та інші медіафайли в месенджерах тарифікуються за стандартними умовами.
   Cosine Similarity: 0.81
   
--------------------------------------------------
 Як поповнити рахунок у роумінгу?
   Model Answer: Згідно з документами, є декілька способів поповнити рахунок у роумінгу:

    *   За допомогою послуги "Екстра гроші" (наберіть запит *117#).
    *   Замовте гроші на бонусний рахунок (наберіть запит *117#).
    *   Повідомте родича, друга або колегу в Україні (надішліть запит 132380YYХХХХХХХ#, де YY — код мережі "Київстар", ХХХХХХХ— номер телефону абонента).
    *   Використовуйте додаток "Мій Київстар" (якщо немає інтернету, можна додати банківську картку та поповнюватись за допомогою останніх 4 цифр картки).
    *   Подзвоніть до оператора служби підтримки за допомогою послуги "Київстар довідка в роумінгу" (наберіть *105*466#).
    *   Якщо ви плануєте поповнювати рахунок за кордоном банківською карткою, переконайтеся, що ваша карта відкрита для інтернет-платежів та попередьте банк про те, що збираєтеся за кордон.
   Ground Truth: У роумінгу рахунок можна поповнити через додаток «Мій Київстар», банківську картку (запит *134#), або за допомогою послуг «Екстра гроші» (*117#) та «Поповни мій рахунок» (запит 132380YYХХХХХХХ#).
   Cosine Similarity: 0.45
   
--------------------------------------------------
 Що робити, якщо на рахунку недостатньо коштів для роумінгу?
   Model Answer: Якщо на вашому рахунку коштів недостатньо для оплати повного пакету хвилин у роумінгу, ви зможете користуватися сервісами, але зверніть увагу на зміну в правилах тарифікації послуг. Ви також можете скористатися послугою "Екстра гроші" або замовити гроші на бонусний рахунок, набравши запит *117#. Щоб дізнатися свою максимальну суму, наберіть — *117*9#. Також можна попросити родича, друга або колегу поповнити ваш рахунок, надіславши запит 132380YYХХХХХХ#.
   Ground Truth: Якщо на рахунку недостатньо коштів для оплати пакету хвилин, мегабайтів або SMS, почнеться похвилинна тарифікація за кожну хвилину, мегабайт або SMS. Якщо коштів недостатньо навіть для цього, послуги зв'язку будуть недоступні до поповнення рахунку.
   Cosine Similarity: 0.20
   
--------------------------------------------------
 Як поповнити рахунок за кордоном без інтернету?
   Model Answer: Якщо ви плануєте поповнювати рахунок за кордоном банківською карткою, переконайтеся, що ваша карта відкрита для інтернет-платежів і попередьте банк про те, що збираєтеся за кордон, щоб платежі з вашої картки не блокувалися в роумінгу. Якщо бракує грошей і не можете наразі поповнитися, скористайтеся однією з послуг: Екстра гроші. також за кордоном ви можете замовити гроші на бонусний рахунок — наберіть запит *117# і отримаєте максимальну суму Екстра грошей. Щоб дізнатися свою максимальну суму, наберіть — *117*9#.
   Ground Truth: Якщо інтернету немає, але банківська картка додана заздалегідь, наберіть *134# і поповнюйтеся, використовуючи останні 4 цифри картки.
   Cosine Similarity: 0.07
   
--------------------------------------------------
 Чи можна надсилати SMS на короткі номери з роумінгу?
   Model Answer: Ні, на короткі номери з роумінгу не можна надсилати SMS.
   Ground Truth: Ні, надсилати SMS на короткі номери (наприклад, 3-х або 4-х значні) з роумінгу неможливо. Технічно відправка SMS можлива, якщо іноземний оператор надає таку можливість, але відповідь на нього не надійде.
   Cosine Similarity: 0.46
   
--------------------------------------------------
 Чи можна користуватися роумінгом у країнах із супутниковим зв'язком?
   Model Answer: Так, роумінг можливий у країнах, де надають послуги оператори супутникового зв'язку та оператори, які надають свої послуги на авіа-/морському транспорті.
   Ground Truth: Так, але дзвінки та SMS у країнах із супутниковим зв'язком (наприклад, Британські Віргінські острови, Куба) тарифікуються за високими ставками: 150 грн/хв за дзвінки та 15 грн за SMS.
   Cosine Similarity: 0.08
   
--------------------------------------------------
 Як діє пропозиція "Роумінг як вдома"?
   Model Answer: Пропозиція "Роумінг як вдома" діє, якщо ви знаходитесь у країні першої або другої тарифної зони та: почали використовувати денний пакет мегабайтів або підключений будь-який пакет роумінгу (Ідеальний, Простий, Комфортний) чи Суперсила роумінг.
   Ground Truth: Пропозиція "Роумінг як вдома" діє, якщо ви знаходитеся у країні першої або другої тарифної зони та використовуєте денний пакет мегабайтів або підключений будь-який пакет роумінгу (Ідеальний, Простий, Комфортний) чи Суперсила роумінг.
   Cosine Similarity: 0.88
   
--------------------------------------------------
 Які країни входять до першої тарифної зони?
   Model Answer: До першої тарифної зони входять: Австрія, Азербайджан, Албанія, Боснія та Герцеговина, Велика Британія, Вірменія, Гренландія, Греція, Грузія (крім Абхазії та Південної Осетії), Данія, Єгипет, Ізраїль, Ірландія, Ісландія, Іспанія (включаючи Канарські о-ви та Гібралтар, о. Ібіца), Італія (включаючи Сан-Марино та Ватикан), Йорданія, Казахстан.
   Ground Truth: До першої тарифної зони входять такі країни, як Австрія, Азербайджан, Албанія, Боснія та Герцеговина, Вірменія, Бельгія, Болгарія, Ватикан, Великобританія, Гібралтар, Гренландія, Греція, Грузія (окрім Абхазії та Південної Осетії), Данія, Естонія, Єгипет, Ізраїль, Ірландія, Ісландія, Іспанія (включно з Канарськими островами і Гібралтаром), Італія (включно з Сан Марино), Йорданія, Казахстан, Канада, Канари, Кіпр (окрім Північного Кіпру), Киргизія, Латвія, Литва, Ліхтенштейн, Люксембург, Мальта, Молдова, Монако, Нідерланди, Німеччина, Норвегія, Палестина, Польща, Португалія, Португалія (Мадейра), Республіка Північна Македонія, Румунія, Сан-Марино, Сербія, Словаччина, Словенія, США (включно з Гавайськими островами і Американськими Віргінськими островами), Таджикистан, Туреччина, Угорщина, Узбекистан, Фарерські острови, Фінляндія (включно з Аландськими островами), Франція, Хорватія, Чорногорія, Чехія, Швейцарія, Швеція, Шрі Ланка, Японія.
   Cosine Similarity: 0.33
   
--------------------------------------------------
 Які країни входять до другої тарифної зони?
   Model Answer: Згідно з документом, до другої тарифної зони входять такі країни: Австралія, Алжир, Ангілья, Андорра, Антигуа і Барбуда, Аргентина, Аруба, Афганістан, Бангладеш, Барбадос, Бахрейн, Бермудські острови, Бразилія, В'єтнам.
   Ground Truth: До другої тарифної зони входять такі країни, як Австралія, Алжир, Ангілья, Андорра, Антигуа і Барбуда, Аргентина, Аруба, Афганістан, Бангладеш, Барбадос, Бахрейн, Бермудські острови, Бразилія, В'єтнам, Гаїті, Гаяна, Гватемала, Гваделупа, Гонконг, Гренада, Демократична Республіка Конго, Домініка, Домініканська Республіка, Судан, Еквадор, Занзібар, Індія, Ірак, Індонезія (включно з о. Балі), Кайманові острови, Кабо-Верде, Кот-д'Івуар, Камбоджа, Катар, Кенія, Китай, Колумбія, Коста-Рика, Кувейт, Мадагаскар, Макао, Малі, Малайзія, Марокко, Маврикій, Мальдіви, Мартиніка, Мексика, Монголія, М'янма, Оман, Непал, Нігерія, Нікарагуа, Нова Зеландія, Об'єднані Арабські Емірати, Пакистан, Панама, Папуа-Нова Гвінея, Парагвай, Перу, Південна Корея, Південно-Африканська Республіка (ПАР), Пуерто-Рико, Ліберія, Сальвадор, Самоа, Саудівська Аравія, Сент-Вінсент і Гренадіни, Сент-Кітс і Невіс, Сент-Люсія, Сінгапур, Тайвань, Таїланд, Танзанія (включно з о. Занзібар), Теркс і Кайкос, Тринідад і Тобаго, Тонга, Туніс, Уругвай, Фіджі, Французька Гвіана, Філіппіни, Чилі, Ямайка.
   Cosine Similarity: 0.29
   
--------------------------------------------------
 Яка вартість дзвінків у першій тарифній зоні?
   Model Answer: За стандартним роумінговим тарифом пакет 10 хв коштує 25,00 грн. Для другої тарифної зони вартість пакету хвилин складатиме 25,00 грн за 5 хвилин.
   Ground Truth: У першій тарифній зоні вартість дзвінків становить 5 грн/хв.
   Cosine Similarity: 0.14
   
--------------------------------------------------
 Яка вартість SMS у першій тарифній зоні?
   Model Answer: Згідно з документом, вартість SMS у першій тарифній зоні (Австрія, Азербайджан, Албанія, Боснія та Герцеговина, Вірменія, Бельгія, Болгарія, Ватикан, Великобританія, Гібралтар, Гренландія, Греція, Грузія (окрім Абхазії та Південної Осетії), Данія) не вказана.
   Ground Truth: У першій тарифній зоні вартість SMS становить 2 грн/SMS.
   Cosine Similarity: 0.23
   
--------------------------------------------------
 Яка вартість мобільного інтернету у першій тарифній зоні?
   Model Answer: 1 грн/МБ
   Ground Truth: У першій тарифній зоні вартість мобільного інтернету становить 1 грн/МБ.
   Cosine Similarity: 0.36
   
--------------------------------------------------
 Яка вартість дзвінків у другій тарифній зоні?
   Model Answer: Вартість пакету хвилин у другій тарифній зоні становить 25,00 грн за 5 хвилин.
   Ground Truth: У другій тарифній зоні вартість дзвінків становить 10 грн/хв.
   Cosine Similarity: 0.37
   
--------------------------------------------------
 Яка вартість SMS у другій тарифній зоні?
   Model Answer: Вартість SMS у другій тарифній зоні - 2 грн/SMS.
   Ground Truth: У другій тарифній зоні вартість SMS становить 2 грн/SMS.
   Cosine Similarity: 0.91
   
--------------------------------------------------
 Яка вартість мобільного інтернету у другій тарифній зоні?
   Model Answer: Мобільний інтернет 5 грн/хв 2 грн/SMS 1 грн/МБ
   Ground Truth: У другій тарифній зоні вартість мобільного інтернету становить 1 грн/МБ.
   Cosine Similarity: 0.24
   
--------------------------------------------------
 Чи відрізняється вартість дзвінків у першій та другій тарифних зонах?
   Model Answer: Так, вартість дзвінків відрізняється у першій та другій тарифних зонах. У другій тарифній зоні вартість пакету хвилин становить 25,00 грн за 5 хвилин.
   Ground Truth: Так, у першій тарифній зоні вартість дзвінків становить 5 грн/хв, а в другій — 10 грн/хв.
   Cosine Similarity: 0.41
   
--------------------------------------------------
 Чи однакова вартість SMS у першій та другій тарифних зонах?
   Model Answer: Я не знаю.
   Ground Truth: Так, вартість SMS однакова в обох зонах і становить 2 грн/SMS.
   Cosine Similarity: 0.00
   
--------------------------------------------------
 Чи однакова вартість мобільного інтернету у першій та другій тарифних зонах?
   Model Answer: Згідно з наданими документами, вартість мобільного інтернету залежить від тарифної зони. У першій тарифній зоні вартість 1 грн/МБ, а у другій - не вказано.
   Ground Truth: Так, вартість мобільного інтернету однакова в обох зонах і становить 1 грн/МБ.
   Cosine Similarity: 0.27





  



